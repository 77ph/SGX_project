# TODO: Security Improvements

## Криптографические улучшения
- [x] Реализовать безопасное удаление чувствительных данных (использовать `sgx_secure_memset` вместо обычного `memset`)
- [x] Удалить неиспользуемый функционал nonce (мы работаем по модели Ledger, где nonce не нужен)

## Управление ключами
- [x] Добавить возможность резервного копирования ключей с шифрованием
- [x] Реализовать механизм восстановления ключей
- [ ] Добавить проверку целостности ключей при каждой операции

## Безопасность энклава
- [ ] Добавить проверку версии энклава при загрузке
- [ ] Реализовать механизм обновления энклава
- [ ] Добавить защиту от rollback-атак при сохранении состояния
- [ ] Реализовать механизм обнаружения компрометации энклава

## Аудит и логирование
- [x] Добавить безопасное логирование критических операций
- [ ] Реализовать механизм аудита доступа к ключам (в серверном варианте с REST API, логирование операций)

## Управление состоянием
- [x] Реализовать пул аккаунтов в памяти:
  - [x] Создать фиксированный пул слотов для аккаунтов (например, 10 слотов)
  - [x] Добавить команды для загрузки аккаунтов в конкретные слоты
  - [x] Модифицировать команду sign_tx для работы с аккаунтами по их адресу в пуле
  - [x] Добавить команды для просмотра состояния пула (занятые/свободные слоты)
  - [x] Реализовать механизм выгрузки аккаунтов из пула
  - [x] Добавить проверки безопасности при работе с пулом

## Восстановление после сбоя железа
- [x] Реализовать опциональное резервное копирование при генерации аккаунта:
  - [x] Добавить параметр для публичного RSA ключа пользователя при генерации
  - [x] Создать дополнительный файл с зашифрованными данными аккаунта (RSA)
  - [x] Сохранять оригинальный файл с SGX шифрованием
  - [x] Добавить команду для проверки наличия резервной копии
  - [x] Реализовать механизм восстановления из резервной копии на новом железе
- [ ] Добавить документацию по процессу восстановления


## Валидация входных данных
- [x] Усилить проверку формата и длины входных данных
- [x] Добавить проверку на переполнение буфера
- [x] Реализовать санитизацию всех входных параметров
- [ ] Добавить проверку на инъекции в параметры команд (в серверном варианте c REST API)

## Управление доступом
- [ ] Реализовать механизм разграничения доступа к разным операциям (в серверном варианте с REST API)
- [ ] Добавить поддержку ролей и разрешений (в серверном варианте c REST API)
- [ ] Добавить проверку прав доступа для каждой операции (в серверном варианте c REST API)


## Документация и тестирование
- [x] Добавить документацию по безопасности
- [x] Реализовать автоматические тесты безопасности
- [ ] Стандартный механизм сообщения о проблемах безопасности (SECURITY.md)

## Новые приоритеты
- [ ] Очистка отладочной информации в Enclave.cpp и App.cpp
- [ ] Реализация REST API интерфейса
- [ ] Оптимизация производительности пула аккаунтов (после внедрения серверного варианта)
- [ ] Улучшение документации API
- [ ] Добавление примеров использования
- [ ] Добавление интеграционных тестов 